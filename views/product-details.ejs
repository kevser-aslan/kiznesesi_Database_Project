<!DOCTYPE html>
<html lang="tr">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title><%= product.name %> - Ürün Detayı</title>
  <link rel="stylesheet" href="/styles/style.css">
  <style>
    /* Genel Stil ve Ortalamalar */
    body {
      font-family: Arial, sans-serif;
      background-color: #f8f8f8;
      margin: 0;
      padding: 0;
    }

    .main-content {
      width: 80%;
      margin: 0 auto;
      padding: 30px 0;
      background-color: #fff;
      border-radius: 8px;
      box-shadow: 0 4px 20px rgba(0, 0, 0, 0.1);
    }

    /* Başlıklar */
    #product-name {
      font-size: 36px;
      font-weight: 600;
      color: #e91e63;
      text-align: center;
      margin-bottom: 20px;
    }

    #product-description {
      font-size: 18px;
      color: #555;
      text-align: center;
      margin-top: 15px;
    }

    #product-price {
      font-size: 24px;
      color: #e91e63;
      font-weight: bold;
      text-align: center;
      margin-top: 20px;
    }

    /* Ürün Görseli */
    #product-image {
      margin-top: 20px;
      display: block;
      margin-left: auto;
      margin-right: auto;
      cursor: pointer;
      transition: transform 0.3s ease-in-out;
      border-radius: 8px;
    }

    #product-image:hover {
      transform: scale(1.05);
    }

    /* Modal */
    #imageModal {
      display: none;
      position: fixed;
      z-index: 1000;
      left: 0;
      top: 0;
      width: 100%;
      height: 100%;
      background-color: rgba(0, 0, 0, 0.7);
      overflow: auto;
    }

    #modalImage {
      margin: 10% auto;
      display: block;
      width: 80%;
      max-width: 700px;
      border-radius: 8px;
    }

    #closeModal {
      position: absolute;
      top: 15px;
      right: 25px;
      color: #fff;
      font-size: 40px;
      font-weight: bold;
      cursor: pointer;
    }

  /* Yorumlar */
#reviews-section {
  margin-top: 40px;
}

#reviews-title {
  font-size: 28px;
  color: #333;
  text-align: center;
  margin-bottom: 20px;
}

#review-list {
  list-style-type: none;
  padding: 0;
  margin: 0;
  max-width: 700px;
  margin: 0 auto;
}

/* Yorumlar Kutusu - Scroll Ekleme */
#review-list {
  max-height: 400px; /* Yüksekliği ihtiyaca göre ayarlayabilirsiniz */
  overflow-y: auto; /* Yorumlar uzun olduğunda scroll ekler */
  padding-right: 15px; /* Scroll çubuğunun görünmesi için sağda boşluk bırakıldı */
}

/* Yorum Item'ı */
.review-item {
  background-color: #fff;
  padding: 20px;
  margin-bottom: 15px;
  border-radius: 8px;
  box-shadow: 0 4px 10px rgba(0, 0, 0, 0.1);
}

.review-item strong {
  color: #e91e63;
}

.review-item p {
  color: #555;
  font-size: 16px;
}

.vote-buttons {
  margin-top: 10px;
  text-align: center;
}

.vote-buttons button {
  background-color: #e91e63;
  color: white;
  border: none;
  padding: 8px 15px;
  cursor: pointer;
  margin: 0 5px;
  border-radius: 5px;
  font-weight: bold;
}

.vote-buttons button:hover {
  background-color: #d81b60;
}

    /* Yorum Ekleme Formu */
    #add-review-form {
      margin-top: 30px;
      padding: 20px;
      background-color: #f8f0f9;
      border-radius: 8px;
      box-shadow: 0 4px 10px rgba(0, 0, 0, 0.1);
      max-width: 700px;
      margin: 0 auto;
    }

    #add-review-form label {
      font-size: 16px;
      color: #333;
      margin-bottom: 8px;
    }

    #add-review-form select,
    #add-review-form textarea {
      width: 100%;
      padding: 10px;
      margin-bottom: 15px;
      border-radius: 5px;
      border: 1px solid #ccc;
    }

    #add-review-form button {
      background-color: #e91e63;
      color: white;
      border: none;
      padding: 10px 20px;
      cursor: pointer;
      font-weight: bold;
      border-radius: 5px;
      display: block;
      margin-left: auto;
      margin-right: auto;
    }

    #add-review-form button:hover {
      background-color: #d81b60;
    }

    /* Sepete Ekleme Formu */
    #add-to-cart-form {
      margin-top: 40px;
      padding: 20px;
      background-color: #f8f0f9;
      border-radius: 8px;
      box-shadow: 0 4px 10px rgba(0, 0, 0, 0.1);
      max-width: 700px;
      margin: 0 auto;
    }

    #add-to-cart-form label {
      font-size: 16px;
      color: #333;
    }

    #add-to-cart-form input[type="number"] {
      width: 100px;
      padding: 8px;
      margin-bottom: 15px;
      border-radius: 5px;
      border: 1px solid #ccc;
    }

    #add-to-cart-form button {
      background-color: #e91e63;
      color: white;
      border: none;
      padding: 10px 20px;
      cursor: pointer;
      font-weight: bold;
      border-radius: 5px;
      display: block;
      margin-left: auto;
      margin-right: auto;
    }

    #add-to-cart-form button:hover {
      background-color: #d81b60;
    }

    .feature-buttons {
  display: flex;
  gap: 10px;
  flex-wrap: wrap;
}

.feature-button {
  background-color: #f4f4f4 !important;
  border: 1px solid #ddd;
  padding: 10px;
  text-align: center;
  cursor: pointer;
}

.feature-button img {
  max-width: 50px;
  max-height: 50px;
}

.feature-button span {
  display: block;
  margin-top: 5px;
}

.feature-button:hover {
  background-color: #e0e0e0;
}

/* Seçili butonun arka planını değiştirme */
.feature-button.selected {
  background-color: #ff66b2; /* Örneğin, pembe bir renk */
  border-color: #ff3385;     /* Kenarlık rengini de değiştirebiliriz */
  color: white;              /* Yazı rengini beyaz yapabiliriz */
}

.feature-button.selected img {
  filter: brightness(1.2);   /* Resmi biraz daha parlak gösterebiliriz */
}
/* Seçili özelliğin stilini değiştirecek CSS */
.feature-button {
    padding: 10px;
    margin: 5px;
    cursor: pointer;
    border: 1px solid #ccc;
    background-color: #fff;
    display: inline-block;
    border-radius: 5px;
}

.feature-button.selected {
    background-color: #ff8c00; /* Seçilen özelliğin arka plan rengi */
    color: white;
    border-color: #ff8c00; /* Seçilen özellik sınır rengi */
}

.feature-button img {
    margin-right: 5px;
}
  </style>
</head>
<body class="page-product-details">
  <%- include('partials/header') %>

  <main class="main-content">
    <h1 id="product-name"><%= product.name %></h1>
    
    <!-- Ürün görselini tıklanabilir hale getirdik -->
    <img src="<%= product.image_url %>" alt="<%= product.name %>" width="300" id="product-image">

    <p id="product-description"><%= product.description %></p>
    <p id="product-price">Fiyat: <%= product.price %> ₺</p>

    <!-- Özellikler Seçimi -->
    <section id="product-features">
      <h2>Ürün Özellikleri</h2>
      <% if (features && features.length > 0) { %>
        <form action="/cart/<%= product.id %>/add-to-cart" method="POST" id="add-to-cart-form">
          <input type="hidden" name="productId" value="<%= product.id %>">
          <input type="hidden" name="featureId" id="selected-feature-id" value="null"> <!-- Varsayılan olarak null olabilir -->
          <input type="hidden" name="featureName" id="selected-feature-name" value=""> <!-- Varsayılan boş -->
          
          <!-- Özelliklerin her biri için buton oluşturuyoruz -->
          <label>Özellik Seçin:</label><br>
          <div class="feature-buttons">
              <% features.forEach(feature => { %>
                  <button type="button" class="feature-button" data-feature-id="<%= feature.id %>" data-feature-name="<%= feature.feature_name %>">
                      <% if (feature.feature_image) { %>
                          <img src="<%= feature.feature_image %>" alt="<%= feature.feature_name %>" width="50" height="50">
                      <% } %>
                      <span><%= feature.feature_name %></span>
                  </button>
              <% }) %>
          </div><br>
          
          <label for="quantity">Adet:</label>
          <input type="number" name="quantity" id="quantity" value="1" min="1" required><br>
          
          <button type="submit">Sepete Ekle</button>
      </form>
      <% } else { %>
        <p>Bu ürünün herhangi bir özelliği bulunmamaktadır.</p>
      <% } %>
    </section>
    
    <!-- Yorumlar -->
    <section id="reviews-section">
      <h2 id="reviews-title">Yorumlar</h2>

      <!-- Yorumları sıralama menüsü -->
      <form method="GET" action="/products/<%= product.id %>">
        <label for="sort">Yorumları Sırala:</label>
        <select name="sort" id="sort" onchange="this.form.submit()">
          <option value="newest" <%= sort === 'newest' ? 'selected' : '' %>>En Yeni</option>
          <option value="highest" <%= sort === 'highest' ? 'selected' : '' %>>En Yüksek Puanlı</option>
          <option value="helpful" <%= sort === 'helpful' ? 'selected' : '' %>>En Faydalı</option>
        </select>
      </form>

      <% if (reviews.length > 0) { %>
        <ul id="review-list">
          <% reviews.forEach(review => { %>
            <li class="review-item">
              <strong><%= review.username %></strong> (<%= review.rating %> puan)
              <p><%= review.comment %></p>
              <p>Faydalı Oylar: <%= review.helpful_votes || 0 %></p>
              <div class="vote-buttons">
                <form action="/products/reviews/<%= review.id %>/vote" method="POST" style="display: inline;">
                  <input type="hidden" name="vote" value="1">
                  <button type="submit">Beğen</button>
                </form>
                <form action="/products/reviews/<%= review.id %>/vote" method="POST" style="display: inline;">
                  <input type="hidden" name="vote" value="-1">
                  <button type="submit">Beğenme</button>
                </form>
              </div>

              <% if (review.replies && review.replies.length > 0) { %>
                <ul>
                  <% review.replies.forEach(reply => { %>
                    <li><strong><%= reply.username %>:</strong> <%= reply.reply_text %></li>
                  <% }) %>
                </ul>
              <% } %>

              <!-- Yanıt Formu -->
              <form action="/products/reviews/reply" method="POST">
                <input type="hidden" name="reviewId" value="<%= review.id %>">
                <label for="replyText">Yanıt:</label>
                <textarea name="replyText" id="replyText" required></textarea><br>
                <button type="submit">Yanıt Gönder</button>
              </form>
            </li>
          <% }) %>
        </ul>
      <% } else { %>
        <p>Henüz yorum yapılmamış.</p>
      <% } %>

      <!-- Yorum Ekleme -->
      <h3>Yorum Ekle</h3>
      <form action="/products/reviews/add" method="POST" id="add-review-form">
        <input type="hidden" name="productId" value="<%= product.id %>">
        <label for="rating">Puan:</label>
        <select name="rating" id="rating" required>
          <option value="1">1</option>
          <option value="2">2</option>
          <option value="3">3</option>
          <option value="4">4</option>
          <option value="5">5</option>
        </select>
        <label for="comment">Yorum:</label>
        <textarea name="comment" id="comment" required></textarea><br>
        <button type="submit">Yorum Gönder</button>
      </form>
    </section>

    <!-- Sepete Ekle -->
    <section id="add-to-cart-section">
      <h2>Sepete Ekle</h2>
      <form action="/cart/<%= product.id %>/add-to-cart2" method="POST" id="add-to-cart-form">
        <input type="hidden" name="productId" value="<%= product.id %>">
        <label for="quantity">Adet:</label>
        <input type="number" name="quantity" id="quantity" value="1" min="1" required><br>
        <button type="submit">Sepete Ekle</button>
      </form>
    </section>

  </main>

  <script>
  const featureButtons = document.querySelectorAll('.feature-button');
  const featureIdInput = document.getElementById('selected-feature-id');
  const featureNameInput = document.getElementById('selected-feature-name');

  // Varsayılan olarak ID ve Name bilgilerini "null" ve boş yap
  featureIdInput.value = "null";
  featureNameInput.value = "";

  // Özellik butonlarına tıklama efekti ekleyelim
  featureButtons.forEach(button => {
    button.addEventListener('click', function() {
      // Daha önce seçili olan butonu eski renginden çıkar
      featureButtons.forEach(btn => btn.classList.remove('selected'));

      // Yeni tıklanan butonu seçili yap
      this.classList.add('selected');

      // Seçilen özelliğin ID ve adı bilgilerini al
      const selectedFeatureId = this.getAttribute('data-feature-id');
      const selectedFeatureName = this.getAttribute('data-feature-name');

      // Formdaki hidden input'lara bilgileri güncelle
      featureIdInput.value = selectedFeatureId;
      featureNameInput.value = selectedFeatureName;

      console.log(`Seçilen Özellik ID: ${selectedFeatureId}, Özellik Adı: ${selectedFeatureName}`);
    });
  });


    // Ürün görseli modal'ını gösterme ve kapama fonksiyonları
    var modal = document.getElementById('imageModal');
    var modalImg = document.getElementById("modalImage");
    var img = document.getElementById("product-image");
    var span = document.getElementById("closeModal");

    img.onclick = function(){
      modal.style.display = "block";
      modalImg.src = this.src;
    }

    span.onclick = function() {
      modal.style.display = "none";
    }

    document.querySelectorAll('.feature-button').forEach(button => {
  button.addEventListener('click', function() {
    // Seçilen featureId'yi ve featureName'yi al
    const featureId = this.getAttribute('data-feature-id');
    const featureName = this.getAttribute('data-feature-name');
    
    // Hidden input'lara featureId ve featureName değerlerini ekle
    document.getElementById('selected-feature-id').value = featureId;
    document.getElementById('selected-feature-name').value = featureName;
    
    // Seçilen butonun stilini değiştir
    document.querySelectorAll('.feature-button').forEach(b => b.classList.remove('selected')); // Tüm butonların stilini sıfırla
    this.classList.add('selected'); // Seçilen butonun stilini değiştir
  });
});



  // Form gönderim kontrolü
  document.querySelector('#add-to-cart-form').addEventListener('submit', function(event) {
    const selectedFeatureId = featureIdInput.value;

    // Eğer özellikler varsa ve hiçbir özellik seçilmemişse uyarı ver
    if (featureButtons.length > 0 && (!selectedFeatureId || selectedFeatureId === "null")) {
      alert('Lütfen bir özellik seçin.');
      event.preventDefault(); // Formun gönderilmesini engelle
    }

    // Eğer özellik yoksa null değerler ile form gönderilsin
    console.log(`Form gönderiliyor: featureId = ${featureIdInput.value}, featureName = ${featureNameInput.value}`);
  });

  </script>

  <%- include('partials/footer') %>
</body>




</html>
